{#
/**
 * @file
 * Template moderne pour les articles/actualités
 */
#}

{{ attach_library('commune_theme/cards') }}

{% set classes = [
  'node',
  'node--type-' ~ node.bundle|clean_class,
  node.isPromoted() ? 'node--promoted',
  node.isSticky() ? 'node--sticky', 
  not node.isPublished() ? 'node--unpublished',
  view_mode ? 'node--view-mode-' ~ view_mode|clean_class,
  'card',
  'card--news'
] %}

<article{{ attributes.addClass(classes) }} itemscope itemtype="https://schema.org/Article">
  
  {# Image de l'article #}
  {% if content.field_image_une %}
    <div class="card-header">
      {{ content.field_image_une }}
      
      {# Badge de catégorie #}
      {% if content.field_category %}
        <div class="card-badge card-badge--primary">
          {{ content.field_category }}
        </div>
      {% endif %}
    </div>
  {% endif %}

  <div class="card-content">
    {# Métadonnées de l'article #}
    <div class="card-meta">
      {% if display_submitted %}
        <div class="node__submitted" itemprop="author" itemscope itemtype="https://schema.org/Person">
          <span class="visually-hidden">{{ 'Publié par'|t }}</span>
          <span itemprop="name">{{ author_name }}</span>
          
          {% if published_date_readable %}
            <time datetime="{{ node.getCreatedTime|date('c') }}" 
                  itemprop="datePublished"
                  class="node__date">
              {{ 'le'|t }} {{ published_date_readable }}
            </time>
          {% endif %}
          
          {# Date de modification si différente #}
          {% if node.getChangedTime != node.getCreatedTime %}
            <time datetime="{{ node.getChangedTime|date('c') }}" 
                  itemprop="dateModified"
                  class="node__updated visually-hidden">
              {{ 'Mis à jour le'|t }} {{ node.getChangedTime|date('j F Y') }}
            </time>
          {% endif %}
        </div>
      {% endif %}

      {# Tags/Catégories #}
      {% if content.field_tags %}
        <div class="node__tags">
          <span class="tags-label">{{ 'Mots-clés :'|t }}</span>
          {{ content.field_tags }}
        </div>
      {% endif %}
    </div>
  </header>

  {# Résumé/Chapô #}
  {% if content.field_resume and view_mode == 'full' %}
    <div class="node__summary" itemprop="description">
      {{ content.field_resume }}
    </div>
  {% endif %}

  {# Contenu principal #}
  <div class="node__content" itemprop="articleBody">
    {% if view_mode == 'teaser' and content.field_resume %}
      {# En mode teaser, afficher le résumé #}
      {{ content.field_resume }}
      
      <div class="node__read-more">
        <a href="{{ url }}" class="read-more-link" 
           aria-label="{{ 'Lire la suite de'|t }} {{ label }}">
          {{ 'Lire la suite'|t }}
          <span aria-hidden="true"> →</span>
        </a>
      </div>
    {% else %}
      {# Mode complet #}
      {{ content.body }}
      
      {# Autres champs #}
      {% for key, item in content if key|first != '#' and key not in ['field_image_une', 'field_resume', 'field_tags', 'body'] %}
        {{ item }}
      {% endfor %}
    {% endif %}
  </div>

  {# Pied de l'article #}
  {% if view_mode == 'full' %}
    <footer class="node__footer">
      {# Partage social accessible #}
      <div class="social-share" role="region" aria-label="{{ 'Partager cet article'|t }}">
        <h3 class="social-share__title">{{ 'Partager'|t }}</h3>
        <ul class="social-share__list">
          <li>
            <a href="https://www.facebook.com/sharer/sharer.php?u={{ url('<current>')|render|url_encode }}" 
               target="_blank" 
               rel="noopener noreferrer"
               aria-label="{{ 'Partager sur Facebook'|t }}">
              <span class="icon-facebook" aria-hidden="true"></span>
              Facebook
            </a>
          </li>
          <li>
            <a href="https://twitter.com/intent/tweet?url={{ url('<current>')|render|url_encode }}&text={{ label|url_encode }}" 
               target="_blank" 
               rel="noopener noreferrer"
               aria-label="{{ 'Partager sur Twitter'|t }}">
              <span class="icon-twitter" aria-hidden="true"></span>
              Twitter
            </a>
          </li>
          <li>
            <a href="mailto:?subject={{ label|url_encode }}&body={{ url('<current>')|render|url_encode }}"
               aria-label="{{ 'Envoyer par email'|t }}">
              <span class="icon-email" aria-hidden="true"></span>
              {{ 'Email'|t }}
            </a>
          </li>
        </ul>
      </div>

      {# Navigation entre articles #}
      {% if view_mode == 'full' %}
        <nav class="node-navigation" aria-label="{{ 'Navigation entre articles'|t }}">
          {# Ces liens seront générés par un bloc ou une vue personnalisée #}
        </nav>
      {% endif %}
    </footer>
  {% endif %}

  {# Données structurées JSON-LD pour le SEO #}
  {% if view_mode == 'full' and schema_type %}
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "{{ schema_type }}",
      "headline": "{{ label|escape('js') }}",
      "author": {
        "@type": "Person",
        "name": "{{ author_name|escape('js') }}"
      },
      "datePublished": "{{ node.getCreatedTime|date('c') }}",
      "dateModified": "{{ node.getChangedTime|date('c') }}",
      {% if content.field_image_une %}
      "image": "{{ file_url(node.field_image_une.entity.fileuri) }}",
      {% endif %}
      "publisher": {
        "@type": "Organization",
        "name": "{{ site_name|escape('js') }}",
        "url": "{{ url('<front>') }}"
      }
    }
    </script>
  {% endif %}
</article>